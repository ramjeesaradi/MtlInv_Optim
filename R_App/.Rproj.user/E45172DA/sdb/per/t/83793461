{
    "collab_server" : "",
    "contents" : "args = commandArgs(trailingOnly=TRUE)\nif(length(args) ==0 ){\n  # print(\"No Args\")\n  setwd(\"/Users/Admin/Documents/workspace/Veero Optim/\")\n  requirementsFile <- list.files(path = \"R_Requirement/\",pattern =\".*\",full.names = T)\n  stockFile <- list.files(path = \"R_Stock/\",pattern =\".*\",full.names = T)\n  tstamp <- format(Sys.time(), format = \"%Y%m%d_%H%M%S\")\n}else {\n  setwd(args[1])\n  requirementsFile <- args[2]\n  tstamp <- requirementsFile\n  tstamp <- gsub(\".*/R_Req_\",\"\",tstamp)\n  stockFile <- args[3]\n  connection <- file(paste(c(\"R_App/logs/log_\",format(Sys.time(), format = \"%Y%m%d_%H%M%S\"),\".txt\"),collapse = \"\"))\n  sink(connection, append=T)\n  sink(connection, append=T, type = \"message\")\n}\n\n\nrequire(lpSolve)\nrequire(reshape)\nrequire(plyr)\nrequire(data.table)\n\nsource(\"R_App/Fns.R\")\nsource(\"R_App/optimDataPrep.R\")\nsource(\"R_App/optimObj.R\")\n\n\nrequirements <- read.csv(requirementsFile\n                         ,sep = \"|\"\n                         ,colClasses = c(Order.No = \"factor\"))\nrequirements$Order.No <- as.factor(requirements$Order.No)\nrequirements$SFG.Material <- sapply(requirements$SFG.Material,function (x) gsub(\" \",\"\",x))\n#### FG from SFG to copy\nrequirements$SFG.Net.Req[requirements$SFG.Material == \"\" | is.na(requirements$SFG.Material)] <- (requirements$FG.Net.Req[requirements$SFG.Material == \"\" | is.na(requirements$SFG.Material)])\nrequirements$SFG.Material[requirements$SFG.Material == \"\" | is.na(requirements$SFG.Material)] <- as.character(requirements$FG.Material[requirements$SFG.Material == \"\" | is.na(requirements$SFG.Material)])\nNAreq <- requirements[(is.na(requirements$Raw.Material)),]\nrequirements <- requirements[!(is.na(requirements$Raw.Material)),]\n\nrequirements$SFG.Material <- sapply(requirements$SFG.Material,function (x) gsub(\" \",\"\",x))\n\n# requirements <- requirements[requirements$SFG.Material == \"870-24042-PART3\",]\n\nStkInp <- read.csv(stockFile\n                   ,sep = \"|\"\n                   ,colClasses = c(Batch = \"factor\"))\n\n################################################\n#to be removed when PR and PO are included\nif(nrow(StkInp)>=1){\n  StkInp$PO.Number <- NA\n  StkInp$PR.Number <- NA\n  StkInp$Open.PO.s <- NA\n  StkInp$Open.PR.s <- NA\n}\n# StkInp$RM.Breadth[StkInp$Type == \"COIL\"] <- 1250\nStkInp <- StkInp[!is.na(StkInp$RM.Breadth),]\n################################################\n\nStkInp <- consolStk(StkInp)\nconv <- read.csv(\"R_Conversion Cost & Wastage/conversion.csv\")\nwst <- as.vector(read.csv(\"R_Conversion Cost & Wastage/Wastage.csv\"))\nconv$Wastage <- getconWst(conv)\n\n##Populating Coil Widths\nrequirements <- populateCoilwidth(requirements,conv)\noutput <- data.frame()\n\nfor(i in unique(requirements[,c(\"Order.No\")]))\n{\n  for(j in unique(requirements[(requirements$Order.No == i),c(\"Item\")]))\n  {\n    for(k in unique(requirements[(requirements$Order.No == i & requirements$Item == j),\"SFG.Material\"])){\n      \n      rmpart <- getrmpart(requirements[(requirements$Order.No == i & requirements$Item == j & requirements$SFG.Material == k),],StkInp,conv)\n      \n      if(nrow(rmpart)>=1){\n        params <- list()\n        rmpart1 <- getFeasibleOpts(rmpart,wst[[1]])\n        params <- getParams(wst[[1]],rmpart1, params)\n        solobj <- runOptim(params)\n        if(solobj$solution ==0){\n          params <- list()\n          params <- getParams(wst[[1]],rmpart, params)\n          params$message <- \"No other feasible options\"\n          solobj <- runOptim(params)\n        }\n        sol <- prepSol(solobj,rmpart,params)\n        sol$Order.No <- i\n        sol$Item <- j\n        output <- rbind.fill(output,sol)\n        \n        StkInp <- updateStk(sol,StkInp)\n        }\n    }\n    output[is.na(as.matrix(output))] <- 0\n    if(is.null(output$fromStock)){output$fromStock <- 0}\n  }\n}\noutput <- output[!(is.na(output$SFG)),]\noutput$wastage <- round(output$wastage,digits = 4)\noutput$Purchase <- round(output$Purchase,digits = 4)\noutput$fromStock <- round(output$fromStock,digits = 4)\nrequirements <- unique(rbind.fill(requirements,NAreq))\nwrite2Disk(output,params,tstamp)\nsink()\nsink(type=\"message\")\nclose(connection)\n",
    "created" : 1464608246938.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1556838335",
    "id" : "83793461",
    "lastKnownWriteTime" : 1465280846,
    "last_content_update" : 1465280846054,
    "path" : "~/workspace/Veero Optim/R_App/optimPart.R",
    "project_path" : "optimPart.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}